<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>objects.Operator &#8212; ChroMo 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for objects.Operator</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">walk</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">objects.ExperimentSet</span> <span class="kn">import</span> <span class="n">ExperimentSet</span>
<span class="kn">from</span> <span class="nn">objects.ExperimentComponent</span> <span class="kn">import</span> <span class="n">ExperimentComponent</span>
<span class="kn">from</span> <span class="nn">objects.Experiment</span> <span class="kn">import</span> <span class="n">Experiment</span>
<span class="kn">from</span> <span class="nn">objects.ExperimentClusters</span> <span class="kn">import</span> <span class="n">ExperimentClusters</span>
<span class="kn">from</span> <span class="nn">functions.Fit_Gauss</span> <span class="kn">import</span> <span class="n">Fit_Gauss</span>
<span class="kn">from</span> <span class="nn">functions.Ret_Time_Cor</span> <span class="kn">import</span> <span class="n">Ret_Time_Cor</span>
<span class="kn">from</span> <span class="nn">functions.Remote_DP_Elim</span> <span class="kn">import</span> <span class="n">Remote_DP_Elim</span>
<span class="kn">from</span> <span class="nn">functions.Deep_Copy_ExperimentSet</span> <span class="kn">import</span> <span class="n">Deep_Copy_ExperimentSet</span>
<span class="kn">from</span> <span class="nn">functions.Mass_Balance_Cor</span> <span class="kn">import</span> <span class="n">Mass_Balance_Cor</span>
<span class="kn">from</span> <span class="nn">functions.Select_Iso_Exp</span> <span class="kn">import</span> <span class="n">Select_Iso_Exp</span>
<span class="kn">from</span> <span class="nn">functions.Loss_Function_Analysis</span> <span class="kn">import</span> <span class="n">Loss_Function_Analysis</span>
<span class="kn">from</span> <span class="nn">functions.Loss_Function_Analysis_Simple</span> <span class="kn">import</span> <span class="n">Loss_Function_Analysis_Simple</span>
<span class="kn">from</span> <span class="nn">functions.Model_Analysis</span> <span class="kn">import</span> <span class="n">Model_Analysis</span>
<span class="kn">from</span> <span class="nn">functions.Solver_Analysis</span> <span class="kn">import</span> <span class="n">Solver_Analysis</span>
<span class="kn">from</span> <span class="nn">functions.Iso_Decision</span> <span class="kn">import</span> <span class="n">Iso_Decision</span>
<span class="kn">from</span> <span class="nn">functions.Compare_ExperimentSets</span> <span class="kn">import</span> <span class="n">Compare_ExperimentSets</span>
<span class="kn">from</span> <span class="nn">functions.Bilevel_Optim</span> <span class="kn">import</span> <span class="n">Bilevel_Optim</span>
<span class="kn">from</span> <span class="nn">functions.solvers.Solver_Choice</span> <span class="kn">import</span> <span class="n">Solver_Choice</span>
<span class="kn">from</span> <span class="nn">functions.Handle_File_Creation</span> <span class="kn">import</span> <span class="n">Handle_File_Creation</span>
<span class="kn">from</span> <span class="nn">functions.Dead_Volume_Adjustment</span> <span class="kn">import</span> <span class="n">Dead_Volume_Adjustment</span>
<span class="kn">from</span> <span class="nn">functions.Dead_Volume_Preprocess</span> <span class="kn">import</span> <span class="n">Dead_Volume_Preprocess</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Time measuring decorator</span>
<span class="sd">&quot;&quot;&quot;</span>
<div class="viewcode-block" id="timeit"><a class="viewcode-back" href="../../objects.html#objects.Operator.timeit">[docs]</a><span class="k">def</span> <span class="nf">timeit</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">timed</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">te</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;log_time&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log_name&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;log_time&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">te</span> <span class="o">-</span> <span class="n">ts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">  </span><span class="si">%2.22f</span><span class="s1"> ms&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">(</span><span class="n">te</span> <span class="o">-</span> <span class="n">ts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">timed</span></div>


<div class="viewcode-block" id="Operator"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator">[docs]</a><span class="k">class</span> <span class="nc">Operator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class orchestrating optimization workflow and command line user interface&quot;&quot;&quot;</span>
<div class="viewcode-block" id="Operator.Start"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Start">[docs]</a>    <span class="k">def</span> <span class="nf">Start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter path to Experiment set: &#39;</span><span class="p">)</span>
        <span class="n">experimentSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Load_Experiment_Set</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">gaussSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Replace experiment data with gauss curve?[Y - yes, N - no]&quot;</span><span class="p">)</span>
        <span class="n">currentExperimentSet</span> <span class="o">=</span> <span class="n">Dead_Volume_Preprocess</span><span class="p">(</span><span class="n">experimentSet</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gaussSelection</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
            <span class="n">currentExperimentSet</span> <span class="o">=</span> <span class="n">Fit_Gauss</span><span class="p">(</span><span class="n">currentExperimentSet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Save_Graphs_To_Directory</span><span class="p">(</span><span class="n">experimentSet</span><span class="p">,</span> <span class="n">currentExperimentSet</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Graphs of Gauss Curves Created.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fitting Gauss Curve skipped.&quot;</span><span class="p">)</span>
        <span class="n">retTimeSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Correct for retention time?[Y - yes, N - no]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retTimeSelection</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
            <span class="n">retTimeThresholdSelection</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select zero threshold for retention time correction.&quot;</span><span class="p">))</span>
            <span class="n">experimentClusterExp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cluster_By_Experiment</span><span class="p">(</span><span class="n">currentExperimentSet</span><span class="p">)</span>
            <span class="n">currentExperimentSet</span> <span class="o">=</span> <span class="n">Ret_Time_Cor</span><span class="p">(</span><span class="n">currentExperimentSet</span><span class="p">,</span> <span class="n">experimentClusterExp</span><span class="p">,</span> <span class="n">retTimeThresholdSelection</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File with Time Corrections Created.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retention Time Correction skipped.&quot;</span><span class="p">)</span>
        <span class="n">massBalanceSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Correct for mass balance?[Y - yes, N - no]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">massBalanceSelection</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
            <span class="n">currentExperimentSet</span> <span class="o">=</span> <span class="n">Mass_Balance_Cor</span><span class="p">(</span><span class="n">currentExperimentSet</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File with Mass Corrections Created.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mass Balance Correction skipped.&quot;</span><span class="p">)</span>
        <span class="n">experimentClusterComp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cluster_By_Component</span><span class="p">(</span><span class="n">currentExperimentSet</span><span class="p">)</span>
        <span class="n">lossFunctionChoices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Simple&#39;</span><span class="p">,</span> <span class="s1">&#39;Squares&#39;</span><span class="p">,</span> <span class="s1">&#39;LogSimple&#39;</span><span class="p">,</span> <span class="s1">&#39;LogSquares&#39;</span><span class="p">]</span>
        <span class="n">lossFunctionString</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lossFunctionChoices</span><span class="p">)</span>
        <span class="n">lossFunctionSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Sellect loss function [&quot;</span> <span class="o">+</span> <span class="n">lossFunctionString</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">)</span>
        <span class="n">solverChoices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lin&#39;</span><span class="p">,</span> <span class="s1">&#39;Nonlin&#39;</span><span class="p">]</span>
        <span class="n">solverString</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">solverChoices</span><span class="p">)</span>
        <span class="n">solverSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Sellect solver [&quot;</span> <span class="o">+</span> <span class="n">solverString</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">)</span>
        <span class="n">factorSelectionString</span> <span class="o">=</span> <span class="s2">&quot;1 - Fc = 1</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                                <span class="s2">&quot;2 - Fc = 1 / maximalOutputConc</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                                <span class="s2">&quot;3 - Fc = 1 / maximalOutputConc^2</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                                <span class="s2">&quot;4 - Fc = 1 / feedConc</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                                <span class="s2">&quot;5 - Fc = 1 / feedConc^2</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                                <span class="s2">&quot;6 - Fc = 1 / feedMass</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                                <span class="s2">&quot;7 - Fc = 1 / feedMass^2</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">factorSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select factor:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">factorSelectionString</span><span class="p">)</span>
        <span class="n">compSelectString</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">experimentClusterComp</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">intervalSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Print graphs to help select intervals?[Y - yes, N - no]&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">intervalSelection</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
            <span class="n">porosity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Porosity: &quot;</span><span class="p">))</span>
            <span class="n">satur</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">solverSelection</span> <span class="o">==</span> <span class="s2">&quot;Nonlin&quot;</span><span class="p">:</span>
                <span class="n">satur</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Saturation Coefficient: &quot;</span><span class="p">))</span>
            <span class="n">Kstart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Start for K interval: &quot;</span><span class="p">))</span>
            <span class="n">Kend</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select End for K interval: &quot;</span><span class="p">))</span>
            <span class="n">Kstep</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Step for K interval: &quot;</span><span class="p">))</span>
            <span class="n">Dstart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Start for D interval: &quot;</span><span class="p">))</span>
            <span class="n">Dend</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select End for D interval: &quot;</span><span class="p">))</span>
            <span class="n">Dstep</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Step for D interval: &quot;</span><span class="p">))</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Component [&quot;</span> <span class="o">+</span> <span class="n">compSelectString</span> <span class="o">+</span> <span class="s2">&quot;]: &quot;</span><span class="p">)</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">Loss_Function_Analysis_Simple</span><span class="p">(</span><span class="n">experimentClusterComp</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">Kstart</span><span class="p">,</span> <span class="n">Dstart</span><span class="p">,</span> <span class="n">Kend</span><span class="p">,</span> <span class="n">Dend</span><span class="p">,</span> <span class="n">Kstep</span><span class="p">,</span> <span class="n">Dstep</span><span class="p">,</span> <span class="n">porosity</span><span class="p">,</span> <span class="n">satur</span><span class="p">,</span> <span class="n">lossFunctionSelection</span><span class="p">,</span> <span class="n">factorSelection</span><span class="p">,</span> <span class="n">solverSelection</span><span class="p">))</span>
            <span class="n">intervalSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Continue with graphs?[Y - yes, N - no]&quot;</span><span class="p">)</span>


        <span class="n">modelAnalysisSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Print solver graph?[Y - yes, N - no]&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">modelAnalysisSelection</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
            <span class="n">component</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Component [&quot;</span> <span class="o">+</span> <span class="n">compSelectString</span> <span class="o">+</span> <span class="s2">&quot;]: &quot;</span><span class="p">)</span>
            <span class="n">experimentString</span> <span class="o">=</span> <span class="s2">&quot;Select Experiment:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">experimentClusterComp</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">component</span><span class="p">]:</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="n">experimentString</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">tail</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">experimentSelection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="n">experimentString</span><span class="p">))</span>
            <span class="n">paramSelection</span> <span class="o">=</span> <span class="s2">&quot;Y&quot;</span>
            <span class="k">while</span> <span class="n">paramSelection</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="n">porosity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Porosity: &quot;</span><span class="p">))</span>
                <span class="n">satur</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">solverSelection</span> <span class="o">==</span> <span class="s2">&quot;Nonlin&quot;</span><span class="p">:</span>
                    <span class="n">satur</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Saturation Coefficient: &quot;</span><span class="p">))</span>
                <span class="n">K</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select K: &quot;</span><span class="p">))</span>
                <span class="n">D</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select D: &quot;</span><span class="p">))</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">porosity</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">satur</span><span class="p">]</span>
                <span class="n">Model_Analysis</span><span class="p">(</span><span class="n">experimentClusterComp</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">experimentSelection</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">solverSelection</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
                <span class="n">paramSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Try different parameters?[Y - yes, N - no]&quot;</span><span class="p">)</span>
            <span class="n">modelAnalysisSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Continue with graphs?[Y - yes, N - no]&quot;</span><span class="p">)</span>

        <span class="n">porosityDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">KDQDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">porosityStart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Start for Porosity interval: &quot;</span><span class="p">))</span>
        <span class="n">porosityEnd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select End for Porosity interval: &quot;</span><span class="p">))</span>
        <span class="n">porosityDict</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select an Initial guess for Porosity interval: &quot;</span><span class="p">))</span>
        <span class="n">porosityDict</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">porosityStart</span><span class="p">,</span> <span class="n">porosityEnd</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">experimentClusterComp</span><span class="o">.</span><span class="n">clusters</span><span class="p">:</span>
            <span class="n">tmpDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">KStart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Start for K interval for component &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
            <span class="n">KEnd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select End for K interval for component &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
            <span class="n">tmpDict</span><span class="p">[</span><span class="s2">&quot;kinit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Initial guess for K interval for component &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
            <span class="n">tmpDict</span><span class="p">[</span><span class="s2">&quot;krange&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">KStart</span><span class="p">,</span> <span class="n">KEnd</span><span class="p">]</span>
            <span class="n">DStart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Start for D interval for component &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
            <span class="n">DEnd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select End for D interval for component &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
            <span class="n">tmpDict</span><span class="p">[</span><span class="s2">&quot;dinit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Initial guess for D interval for component &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
            <span class="n">tmpDict</span><span class="p">[</span><span class="s2">&quot;drange&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">DStart</span><span class="p">,</span> <span class="n">DEnd</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">solverSelection</span> <span class="o">==</span> <span class="s2">&quot;Nonlin&quot;</span><span class="p">:</span>
                <span class="n">QStart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Start for Q interval for component &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
                <span class="n">QEnd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select End for Q interval for component &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
                <span class="n">tmpDict</span><span class="p">[</span><span class="s2">&quot;qinit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Initial guess for Q interval for component &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
                <span class="n">tmpDict</span><span class="p">[</span><span class="s2">&quot;qrange&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">QStart</span><span class="p">,</span> <span class="n">QEnd</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmpDict</span><span class="p">[</span><span class="s2">&quot;qinit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">tmpDict</span><span class="p">[</span><span class="s2">&quot;qrange&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">KDQDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmpDict</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Bilevel_Optim</span><span class="p">(</span><span class="n">currentExperimentSet</span><span class="p">,</span> <span class="n">experimentClusterComp</span><span class="p">,</span> <span class="n">porosityDict</span><span class="p">,</span> <span class="n">KDQDict</span><span class="p">,</span> <span class="n">lossFunctionSelection</span><span class="p">,</span> <span class="n">factorSelection</span><span class="p">,</span> <span class="n">solverSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Save_Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">chromatogramSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Create Chromatogram?[Y - yes, N - no]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chromatogramSelection</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;Chromatograms&quot;</span>
            <span class="n">dirPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
            <span class="n">Handle_File_Creation</span><span class="p">(</span><span class="n">dirPath</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">chromatogramSelection</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select Component [&quot;</span> <span class="o">+</span> <span class="n">compSelectString</span> <span class="o">+</span> <span class="s2">&quot;]: &quot;</span><span class="p">)</span>
                <span class="n">conditionSelectionString</span> <span class="o">=</span> <span class="s2">&quot;Select one of the following conditions:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">compObj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">experimentClusterComp</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">comp</span><span class="p">]):</span>
                    <span class="n">conditionSelectionString</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
                                                <span class="s2">&quot; - Column diameter: &quot;</span> <span class="o">+</span> \
                                                <span class="nb">str</span><span class="p">(</span><span class="n">compObj</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">columnDiameter</span><span class="p">)</span> <span class="o">+</span> \
                                                <span class="s2">&quot;, Column length: &quot;</span> <span class="o">+</span> \
                                                <span class="nb">str</span><span class="p">(</span><span class="n">compObj</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">columnLength</span><span class="p">)</span> <span class="o">+</span> \
                                                <span class="s2">&quot;, Feed time: &quot;</span> <span class="o">+</span> \
                                                <span class="nb">str</span><span class="p">(</span><span class="n">compObj</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">feedTime</span><span class="p">)</span> <span class="o">+</span> \
                                                <span class="s2">&quot;, Feed Volume: &quot;</span> <span class="o">+</span> \
                                                <span class="nb">str</span><span class="p">(</span><span class="n">compObj</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">feedVolume</span><span class="p">)</span> <span class="o">+</span> \
                                                <span class="s2">&quot;, Dead Volume: &quot;</span> <span class="o">+</span> \
                                                <span class="nb">str</span><span class="p">(</span><span class="n">compObj</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">deadVolume</span><span class="p">)</span> <span class="o">+</span> \
                                                <span class="s2">&quot;, Flow rate: &quot;</span> <span class="o">+</span> \
                                                <span class="nb">str</span><span class="p">(</span><span class="n">compObj</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">flowRate</span><span class="p">)</span> <span class="o">+</span> \
                                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">conditionSelection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="n">conditionSelectionString</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">saturVal</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">solverSelection</span> <span class="o">==</span> <span class="s2">&quot;Nonlin&quot;</span><span class="p">:</span>
                    <span class="n">saturVal</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;compparams&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">selectedComp</span> <span class="o">=</span> <span class="n">experimentClusterComp</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="n">conditionSelection</span><span class="p">]</span>
                <span class="n">solverOutput</span> <span class="o">=</span> <span class="n">Solver_Choice</span><span class="p">(</span><span class="n">solverSelection</span><span class="p">,</span>
                                             <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;porosity&quot;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;compparams&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;compparams&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">saturVal</span><span class="p">],</span>
                                             <span class="n">selectedComp</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">experimentClusterComp</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="n">conditionSelection</span><span class="p">]</span><span class="o">.</span><span class="n">concentrationTime</span>
                <span class="n">minTime</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">maxTime</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minTime</span><span class="p">,</span> <span class="n">maxTime</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
                <span class="n">resultDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span> <span class="s1">&#39;concentration&#39;</span><span class="p">:</span> <span class="n">solverOutput</span><span class="p">})</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="s2">&quot;chromatogram_&quot;</span> <span class="o">+</span> <span class="n">comp</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">conditionSelection</span><span class="p">)</span>
                <span class="n">filePath</span> <span class="o">=</span> <span class="n">dirPath</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
                <span class="n">resultDF</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">chromatogramSelection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;More Chromatograms?[Y - yes, N - no]&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Operator.Web_Start"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Web_Start">[docs]</a>    <span class="k">def</span> <span class="nf">Web_Start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experimentSet</span><span class="p">,</span> <span class="n">gauss</span><span class="p">,</span> <span class="n">retCorr</span><span class="p">,</span> <span class="n">massBal</span><span class="p">,</span> <span class="n">lossFunc</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">porosityStart</span><span class="p">,</span> <span class="n">porosityEnd</span><span class="p">,</span> <span class="n">porosityInit</span><span class="p">,</span> <span class="n">KDQDict</span><span class="p">,</span> <span class="n">spacialDiff</span><span class="p">,</span> <span class="n">timeDiff</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">optimId</span><span class="p">,</span> <span class="n">retThreshold</span><span class="p">,</span> <span class="n">lvl1optim</span><span class="p">,</span> <span class="n">lvl2optim</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">currentExperimentSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Preprocess</span><span class="p">(</span><span class="n">experimentSet</span><span class="p">,</span> <span class="n">gauss</span><span class="p">,</span> <span class="n">retCorr</span><span class="p">,</span> <span class="n">massBal</span><span class="p">,</span> <span class="n">retThreshold</span><span class="p">)</span>
        <span class="n">experimentClusterComp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cluster_By_Component</span><span class="p">(</span><span class="n">currentExperimentSet</span><span class="p">)</span>
        <span class="n">lossFunctionSelection</span> <span class="o">=</span> <span class="n">lossFunc</span>
        <span class="n">solverSelection</span> <span class="o">=</span> <span class="n">solver</span>
        <span class="n">factorSelection</span> <span class="o">=</span> <span class="n">factor</span>
        <span class="n">porosityDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">porosityDict</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">porosityInit</span>
        <span class="n">porosityDict</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">porosityStart</span><span class="p">,</span> <span class="n">porosityEnd</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Bilevel_Optim</span><span class="p">(</span><span class="n">currentExperimentSet</span><span class="p">,</span> <span class="n">experimentClusterComp</span><span class="p">,</span> <span class="n">porosityDict</span><span class="p">,</span> <span class="n">KDQDict</span><span class="p">,</span> <span class="n">lossFunctionSelection</span><span class="p">,</span> <span class="n">factorSelection</span><span class="p">,</span> <span class="n">solverSelection</span><span class="p">,</span> <span class="n">spacialDiff</span><span class="p">,</span> <span class="n">timeDiff</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">optimId</span><span class="p">,</span> <span class="n">lvl1optim</span><span class="p">,</span> <span class="n">lvl2optim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retCorr</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;shifts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">currentExperimentSet</span><span class="o">.</span><span class="n">experiments</span><span class="p">:</span>
                <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;shifts&quot;</span><span class="p">][</span><span class="n">tail</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">shift</span>
        <span class="k">if</span> <span class="n">massBal</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;originalFeedTimes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;newFeedTimes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">currentExperimentSet</span><span class="o">.</span><span class="n">experiments</span><span class="p">:</span>
                <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;originalFeedTimes&quot;</span><span class="p">][</span><span class="n">tail</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">originalFeedTime</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;newFeedTimes&quot;</span><span class="p">][</span><span class="n">tail</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">feedTime</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;optimparams&quot;</span><span class="p">][</span><span class="s2">&quot;gauss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gauss</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;optimparams&quot;</span><span class="p">][</span><span class="s2">&quot;retCorr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retCorr</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;optimparams&quot;</span><span class="p">][</span><span class="s2">&quot;retThreshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retThreshold</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;optimparams&quot;</span><span class="p">][</span><span class="s2">&quot;massBal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">massBal</span>
        <span class="k">return</span> <span class="n">result</span></div>



    <span class="c1">#Start for testing purposes</span>

<div class="viewcode-block" id="Operator.Start_For_Testing"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Start_For_Testing">[docs]</a>    <span class="nd">@timeit</span>
    <span class="k">def</span> <span class="nf">Start_For_Testing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Nonlin_Solver()</span>
        <span class="c1">#path = &quot;C:\\Users\\z004d8nt\\PycharmProjects\\ChoMo\\docu\\TestExperimentSet1&quot;</span>
        <span class="c1">#Single_Loss_Function(experimentSet.experiments[0])</span>
        <span class="c1">#experimentSetCopy = Fit_Gauss(experimentSetCopy)</span>
        <span class="c1">#Compare_ExperimentSets(experimentSet, experimentSetCopy)</span>

        <span class="c1">#comp = experimentSetCopy.experiments[0].experimentComponents[0]</span>
        <span class="c1">#cond = experimentSetCopy.experiments[0].experimentCondition</span>
        <span class="c1">#print(cond.flowRate, cond.columnLength, cond.columnDiameter, cond.feedVolume, comp.feedConcentration)</span>
        <span class="c1">#res = Lin_Solver(cond.flowRate, cond.columnLength, cond.columnDiameter, cond.feedVolume, comp.feedConcentration, 0.52 ,12000,  8000, debugPrint=True, debugGraph=True)</span>
        <span class="c1"># C:\Users\Adam\ChroMo\docu\LossFunctionSingleExperiment</span>
        <span class="c1"># C:\Users\Adam\ChroMo\docu\LossFunctionExperimentSet</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">Adam</span><span class="se">\\</span><span class="s2">ChroMo</span><span class="se">\\</span><span class="s2">docu</span><span class="se">\\</span><span class="s2">LossFunctionExperimentSet&quot;</span>
        <span class="n">experimentSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Load_Experiment_Set</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="c1">#Solver_Analysis(experimentSet, [&quot;Glc&quot;, &quot;Sac&quot;, &quot;ManOH&quot;], [[0.2, 10, 10], [0.2, 10, 10], [0.2, 10, 10]], &quot;Lin&quot;)</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;solution = Solution()</span>
<span class="sd">        for exp in experimentSet.experiments:</span>
<span class="sd">            for comp in exp.experimentComponents:</span>
<span class="sd">                solution.Add_Result(comp.name, comp.experiment.metadata.path, random.random(), random.random(), random.random())</span>
<span class="sd">        solution.Export_To_CSV(&quot;C:\\Users\\Adam\\ChroMo\\testSolution.csv&quot;)&#39;&#39;&#39;</span>
        <span class="n">experimentSetCopy</span> <span class="o">=</span> <span class="n">Deep_Copy_ExperimentSet</span><span class="p">(</span><span class="n">experimentSet</span><span class="p">)</span>
        <span class="n">experimentSetGauss</span> <span class="o">=</span> <span class="n">Fit_Gauss</span><span class="p">(</span><span class="n">experimentSetCopy</span><span class="p">)</span>
        <span class="n">experimentSetCompCond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cluster_By_Condition2</span><span class="p">(</span><span class="n">experimentSetGauss</span><span class="p">)</span>
        <span class="n">experimentSetCor2</span> <span class="o">=</span> <span class="n">Ret_Time_Cor</span><span class="p">(</span><span class="n">experimentSetGauss</span><span class="p">,</span> <span class="n">experimentSetCompCond</span><span class="p">)</span>
        <span class="n">experimentSetCor3</span> <span class="o">=</span> <span class="n">Mass_Balance_Cor</span><span class="p">(</span><span class="n">experimentSetCor2</span><span class="p">)</span>
        <span class="c1">#Compare_ExperimentSets(experimentSet, experimentSetCor3)</span>
        <span class="c1">#expIso = Select_Iso_Exp(experimentSetCopy, experimentClusterComp)</span>
        <span class="c1">#testRes = Iso_Decision(expIso, [0.3, 15, 15])</span>
        <span class="c1">#print(testRes)</span>
        <span class="n">experimentClusterComp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cluster_By_Component</span><span class="p">(</span><span class="n">experimentSetCor2</span><span class="p">)</span>
        <span class="n">Loss_Function_Analysis</span><span class="p">(</span><span class="n">experimentClusterComp</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s1">&#39;Glc&#39;</span><span class="p">,</span> <span class="n">ystart</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">yend</span><span class="o">=</span><span class="mi">76</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">xstart</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xend</span><span class="o">=</span><span class="mi">201</span><span class="p">,</span> <span class="n">xstep</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">porosityStart</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">porosityStep</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">lossFunctionChoice</span><span class="o">=</span><span class="s2">&quot;Squares&quot;</span><span class="p">,</span> <span class="n">logScale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Loss_Function_Analysis</span><span class="p">(</span><span class="n">experimentClusterComp</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s1">&#39;Glc&#39;</span><span class="p">,</span> <span class="n">ystart</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">yend</span><span class="o">=</span><span class="mi">76</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">xstart</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xend</span><span class="o">=</span><span class="mi">401</span><span class="p">,</span> <span class="n">xstep</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">porosityStart</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">porosityStep</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">lossFunctionChoice</span><span class="o">=</span><span class="s2">&quot;Squares&quot;</span><span class="p">,</span> <span class="n">logScale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
        <span class="c1">#experimentClusterCompCond = self.Cluster_By_Condition2(experimentSetCopy)</span>
        <span class="c1">#experimentSetCopy = Ret_Time_Cor(experimentSetCopy, experimentClusterCompCond)</span>
        <span class="c1">#experimentSetCopy = Mass_Balance_Cor(experimentSetCopy, experimentSetCopy)</span>

        <span class="c1">#comp = experimentSetCopy.experiments[0].experimentComponents[2].concentrationTime</span>
        <span class="c1">#cond = experimentSetCopy.experiments[0].experimentCondition</span>
        <span class="c1">#plt.scatter(comp[&#39;time&#39;],comp[&#39;Fru&#39;])</span>
        <span class="c1">#plt.show()</span>
        <span class="c1">#comp.plot(x =&#39;Time&#39;, y=&#39;Sac&#39;)</span>
        <span class="c1">#plt.show()</span>
        <span class="c1">#t = np.linspace(0, 10800, 5000)</span>
        <span class="c1">#plt.plot(t, res[:, -1])</span>
        <span class="c1">#plt.show()</span>
        <span class="c1">#result = Bilevel_Optim(experimentSetCopy, experimentClusterComp)</span>
        <span class="c1">#result = Lev2_Optim([150, 235, 16, 3, 150e-3], experimentClusterComp.clusters[&#39;Sac&#39;])</span>
        <span class="c1">#print(result)</span>
        <span class="c1">#expIso = Select_Iso_Exp(experimentSetCopy, experimentClusterComp)</span>
        <span class="c1">#experimentSetCor1 = Mass_Balance_Cor(experimentSet, experimentSet)</span>

<div class="viewcode-block" id="Operator.Save_Result"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Save_Result">[docs]</a>    <span class="k">def</span> <span class="nf">Save_Result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">parentDir</span><span class="p">):</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;Result&quot;</span>
        <span class="n">dirPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">Handle_File_Creation</span><span class="p">(</span><span class="n">dirPath</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="s2">&quot;Result.txt&quot;</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirPath</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">Handle_File_Creation</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Final Porosity: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;porosity&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Final Lv2 Loss Function Value: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;lv1lossfunctionval&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;compparams&quot;</span><span class="p">]:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;For component &quot;</span> <span class="o">+</span> <span class="n">comp</span> <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    Final K value: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;compparams&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    Final D value: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;compparams&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;compparams&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;compparams&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    Final Q value: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;compparams&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    Final Lv2 Loss Function Value: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;lv2lossfunctionvals&quot;</span><span class="p">][</span><span class="n">comp</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Operator.Save_Graphs_To_Directory"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Save_Graphs_To_Directory">[docs]</a>    <span class="k">def</span> <span class="nf">Save_Graphs_To_Directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experimentSet</span><span class="p">,</span> <span class="n">experimentSetGauss</span><span class="p">,</span> <span class="n">parentDir</span><span class="p">):</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;Gauss_graphs&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">Handle_File_Creation</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">figNum</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">exp1</span><span class="p">,</span> <span class="n">expG</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">experimentSet</span><span class="o">.</span><span class="n">experiments</span><span class="p">,</span> <span class="n">experimentSetGauss</span><span class="o">.</span><span class="n">experiments</span><span class="p">):</span>
            <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">exp1</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">extesion</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">comp1</span><span class="p">,</span> <span class="n">compG</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">exp1</span><span class="o">.</span><span class="n">experimentComponents</span><span class="p">,</span> <span class="n">expG</span><span class="o">.</span><span class="n">experimentComponents</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figNum</span><span class="p">)</span>
                <span class="n">figNum</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">time1</span> <span class="o">=</span> <span class="n">comp1</span><span class="o">.</span><span class="n">concentrationTime</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                <span class="n">conc1</span> <span class="o">=</span> <span class="n">comp1</span><span class="o">.</span><span class="n">concentrationTime</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                <span class="n">timeG</span> <span class="o">=</span> <span class="n">compG</span><span class="o">.</span><span class="n">concentrationTime</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                <span class="n">concG</span> <span class="o">=</span> <span class="n">compG</span><span class="o">.</span><span class="n">concentrationTime</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="n">conc1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;original data&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeG</span><span class="p">,</span> <span class="n">concG</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Gauss curve&quot;</span><span class="p">)</span>
                <span class="n">graphName</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;//Gauss_&quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">comp1</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">graphName</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Operator.Load_Experimet_JSON"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Load_Experimet_JSON">[docs]</a>    <span class="k">def</span> <span class="nf">Load_Experimet_JSON</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experimentSet</span><span class="p">,</span> <span class="n">jsonString</span><span class="p">):</span>
        <span class="n">jsonDict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jsonString</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">jsonDict</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
        <span class="n">experimentDate</span> <span class="o">=</span> <span class="n">jsonDict</span><span class="p">[</span><span class="s2">&quot;experimentDate&quot;</span><span class="p">]</span>
        <span class="n">columnLength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">jsonDict</span><span class="p">[</span><span class="s2">&quot;columnLength&quot;</span><span class="p">])</span>
        <span class="n">columnDiameter</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">jsonDict</span><span class="p">[</span><span class="s2">&quot;columnDiameter&quot;</span><span class="p">])</span>
        <span class="n">flowRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">jsonDict</span><span class="p">[</span><span class="s2">&quot;flowRate&quot;</span><span class="p">])</span>
        <span class="n">deadVolume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">jsonDict</span><span class="p">[</span><span class="s2">&quot;deadVolume&quot;</span><span class="p">])</span>
        <span class="n">feedVolume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">jsonDict</span><span class="p">[</span><span class="s2">&quot;feedVolume&quot;</span><span class="p">])</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>
        <span class="n">experiment</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">experimentDate</span>
        <span class="n">experiment</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="n">experiment</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">jsonDict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">flowRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">flowRate</span><span class="p">)</span>
        <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">deadVolume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">deadVolume</span><span class="p">)</span>
        <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">feedVolume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">feedVolume</span><span class="p">)</span>
        <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">columnLength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">columnLength</span><span class="p">)</span>
        <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">columnDiameter</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">columnDiameter</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">compDict</span> <span class="ow">in</span> <span class="n">jsonDict</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">]:</span>
            <span class="n">experimentComponent</span> <span class="o">=</span> <span class="n">ExperimentComponent</span><span class="p">()</span>
            <span class="n">experimentComponent</span><span class="o">.</span><span class="n">concentrationTime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">compDict</span><span class="p">[</span><span class="s2">&quot;concentrationTime&quot;</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;split&quot;</span><span class="p">)</span>
            <span class="n">experimentComponent</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">compDict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">experimentComponent</span><span class="o">.</span><span class="n">feedConcentration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">compDict</span><span class="p">[</span><span class="s2">&quot;feedConcentration&quot;</span><span class="p">])</span>
            <span class="n">experimentComponent</span><span class="o">.</span><span class="n">experiment</span> <span class="o">=</span> <span class="n">experiment</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">experimentComponents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experimentComponent</span><span class="p">)</span>
        <span class="n">experimentSet</span><span class="o">.</span><span class="n">experiments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span></div>


<div class="viewcode-block" id="Operator.Load_Experiment_Set"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Load_Experiment_Set">[docs]</a>    <span class="k">def</span> <span class="nf">Load_Experiment_Set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">experimentSet</span> <span class="o">=</span> <span class="n">ExperimentSet</span><span class="p">()</span>
        <span class="n">experimentSet</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">experimentSet</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y&quot;</span><span class="p">)</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]))[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xls&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="n">columnLength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">columnDiameter</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">flowRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">feedVolume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">deadVolume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">columnNames</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">7</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">columnNames</span><span class="p">)</span>
            <span class="n">feedConcentrations</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">6</span><span class="p">]]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columnNames</span>
            <span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">file</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">flowRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">flowRate</span><span class="p">)</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">feedVolume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">feedVolume</span><span class="p">)</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">deadVolume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">deadVolume</span><span class="p">)</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">columnLength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">columnLength</span><span class="p">)</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">columnDiameter</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">columnDiameter</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">experimentComponent</span> <span class="o">=</span> <span class="n">ExperimentComponent</span><span class="p">()</span>
                <span class="n">experimentComponent</span><span class="o">.</span><span class="n">concentrationTime</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">experimentComponent</span><span class="o">.</span><span class="n">concentrationTime</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">experimentComponent</span><span class="o">.</span><span class="n">concentrationTime</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
                <span class="n">experimentComponent</span><span class="o">.</span><span class="n">concentrationTime</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">experimentComponent</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">columnNames</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">index</span><span class="p">]</span>
                <span class="n">experimentComponent</span><span class="o">.</span><span class="n">feedConcentration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">feedConcentrations</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                <span class="n">experimentComponent</span><span class="o">.</span><span class="n">experiment</span> <span class="o">=</span> <span class="n">experiment</span>
                <span class="n">experiment</span><span class="o">.</span><span class="n">experimentComponents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experimentComponent</span><span class="p">)</span>
            <span class="n">experimentSet</span><span class="o">.</span><span class="n">experiments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">experimentSet</span></div>

<div class="viewcode-block" id="Operator.Preprocess"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Preprocess">[docs]</a>    <span class="k">def</span> <span class="nf">Preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experimentSet</span><span class="p">,</span> <span class="n">gauss</span><span class="p">,</span> <span class="n">retCorr</span><span class="p">,</span> <span class="n">massBal</span><span class="p">,</span> <span class="n">retThreshold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">currExperimentSet</span> <span class="o">=</span> <span class="n">Dead_Volume_Preprocess</span><span class="p">(</span><span class="n">experimentSet</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gauss</span><span class="p">:</span>
            <span class="n">currExperimentSet</span> <span class="o">=</span> <span class="n">Fit_Gauss</span><span class="p">(</span><span class="n">currExperimentSet</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retCorr</span><span class="p">:</span>
            <span class="n">experimentClusterExp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cluster_By_Experiment</span><span class="p">(</span><span class="n">currExperimentSet</span><span class="p">)</span>
            <span class="n">currExperimentSet</span> <span class="o">=</span> <span class="n">Ret_Time_Cor</span><span class="p">(</span><span class="n">currExperimentSet</span><span class="p">,</span> <span class="n">experimentClusterExp</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">retThreshold</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">massBal</span><span class="p">:</span>
            <span class="n">currExperimentSet</span> <span class="o">=</span> <span class="n">Mass_Balance_Cor</span><span class="p">(</span><span class="n">currExperimentSet</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">currExperimentSet</span></div>

<div class="viewcode-block" id="Operator.Cluster_By_Component"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Cluster_By_Component">[docs]</a>    <span class="k">def</span> <span class="nf">Cluster_By_Component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experimentSet</span><span class="p">):</span>
        <span class="n">componentDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experimentSet</span><span class="o">.</span><span class="n">experiments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">experiment</span><span class="o">.</span><span class="n">experimentComponents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">componentDict</span><span class="p">:</span>
                    <span class="n">componentDict</span><span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">componentDict</span><span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                    <span class="n">componentDict</span><span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="n">ExperimentClusters</span><span class="p">()</span>
        <span class="n">clusters</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">experimentSet</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="n">componentDict</span>
        <span class="n">clusters</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Clusters by component&quot;</span>
        <span class="k">return</span> <span class="n">clusters</span></div>

<div class="viewcode-block" id="Operator.Cluster_By_Condition"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Cluster_By_Condition">[docs]</a>    <span class="k">def</span> <span class="nf">Cluster_By_Condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experimentSet</span><span class="p">):</span>
        <span class="n">clusterByCondition</span> <span class="o">=</span> <span class="n">ExperimentClusters</span><span class="p">()</span>
        <span class="n">clusterByCondition</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">experimentSet</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">clusterByCondition</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Clusters by condition&quot;</span>
        <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experimentSet</span><span class="o">.</span><span class="n">experiments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">experiment</span><span class="o">.</span><span class="n">experimentComponents</span><span class="p">:</span>
                <span class="n">foundFlag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">clusterByCondition</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cluster_Match</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">component</span><span class="p">):</span>
                        <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
                        <span class="n">foundFlag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">foundFlag</span><span class="p">:</span>
                    <span class="n">clusterByCondition</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Create_Key</span><span class="p">(</span><span class="n">component</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                    <span class="n">clusterByCondition</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Create_Key</span><span class="p">(</span><span class="n">component</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clusterByCondition</span></div>

<div class="viewcode-block" id="Operator.Cluster_By_Condition2"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Cluster_By_Condition2">[docs]</a>    <span class="k">def</span> <span class="nf">Cluster_By_Condition2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experimentSet</span><span class="p">):</span>
        <span class="n">clusterByCondition</span> <span class="o">=</span> <span class="n">ExperimentClusters</span><span class="p">()</span>
        <span class="n">clusterByCondition</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">experimentSet</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">clusterByCondition</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Clusters by condition&quot;</span>
        <span class="n">tmpCompList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experimentSet</span><span class="o">.</span><span class="n">experiments</span><span class="p">:</span>
            <span class="n">tmpCompList</span> <span class="o">=</span> <span class="n">tmpCompList</span> <span class="o">+</span> <span class="n">experiment</span><span class="o">.</span><span class="n">experimentComponents</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpCompList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxCount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">maxCluster</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">experimentComp</span> <span class="ow">in</span> <span class="n">tmpCompList</span><span class="p">:</span>
                <span class="n">tmpCluster</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="n">tmpCluster</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experimentComp</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">experimentComp2</span> <span class="ow">in</span> <span class="n">tmpCompList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">experimentComp</span> <span class="o">!=</span> <span class="n">experimentComp2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cluster_Match</span><span class="p">(</span><span class="n">experimentComp</span><span class="p">,</span> <span class="n">experimentComp2</span><span class="p">):</span>
                        <span class="n">tmpCluster</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experimentComp2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpCluster</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxCount</span><span class="p">:</span>
                    <span class="n">maxCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpCluster</span><span class="p">)</span>
                    <span class="n">maxCluster</span> <span class="o">=</span> <span class="n">tmpCluster</span>
            <span class="n">clusterByCondition</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Create_Key</span><span class="p">(</span><span class="n">maxCluster</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="n">maxCluster</span>
            <span class="n">tmpCompList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmpCompList</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">maxCluster</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">clusterByCondition</span></div>

<div class="viewcode-block" id="Operator.Cluster_By_Experiment"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Cluster_By_Experiment">[docs]</a>    <span class="k">def</span> <span class="nf">Cluster_By_Experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experimentSet</span><span class="p">):</span>
        <span class="n">clusterByExperiment</span> <span class="o">=</span> <span class="n">ExperimentClusters</span><span class="p">()</span>
        <span class="n">clusterByExperiment</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">experimentSet</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">clusterByExperiment</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Clusters by experiments&quot;</span>
        <span class="n">tmpCompList</span> <span class="o">=</span> <span class="n">experimentSet</span><span class="o">.</span><span class="n">experiments</span>
        <span class="n">dictKey</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpCompList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxCount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">maxCluster</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">tmpCompList</span><span class="p">:</span>
                <span class="n">tmpCluster</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="n">tmpCluster</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">experiment2</span> <span class="ow">in</span> <span class="n">tmpCompList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">experiment</span> <span class="o">!=</span> <span class="n">experiment2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cluster_Match_Exp</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">experiment2</span><span class="p">):</span>
                        <span class="n">tmpCluster</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experiment2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpCluster</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxCount</span><span class="p">:</span>
                    <span class="n">maxCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpCluster</span><span class="p">)</span>
                    <span class="n">maxCluster</span> <span class="o">=</span> <span class="n">tmpCluster</span>
            <span class="n">clusterByExperiment</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">dictKey</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxCluster</span><span class="p">]</span>
            <span class="n">tmpCompList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmpCompList</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">maxCluster</span><span class="p">]</span>
            <span class="n">dictKey</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">clusterByExperiment</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">componentDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">experiment</span><span class="o">.</span><span class="n">experimentComponents</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">componentDict</span><span class="p">:</span>
                        <span class="n">componentDict</span><span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">componentDict</span><span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                        <span class="n">componentDict</span><span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
            <span class="n">clusterByExperiment</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">componentDict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clusterByExperiment</span></div>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates if comp2 is close to comp1 with tolerance(default 0.05)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Operator.Cluster_Match"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Cluster_Match">[docs]</a>    <span class="k">def</span> <span class="nf">Cluster_Match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp1</span><span class="p">,</span> <span class="n">comp2</span><span class="p">,</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calling Cluster_Match&quot;</span><span class="p">)</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="n">comp1</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">comp2</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span>
        <span class="k">if</span><span class="p">(</span><span class="n">comp1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">comp2</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">comp1</span><span class="o">.</span><span class="n">feedConcentration</span> <span class="o">-</span> <span class="n">comp2</span><span class="o">.</span><span class="n">feedConcentration</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span> <span class="o">*</span> <span class="n">comp1</span><span class="o">.</span><span class="n">feedConcentration</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">cond1</span><span class="o">.</span><span class="n">flowRate</span> <span class="o">-</span> <span class="n">cond2</span><span class="o">.</span><span class="n">flowRate</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span> <span class="o">*</span> <span class="n">cond1</span><span class="o">.</span><span class="n">flowRate</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">cond1</span><span class="o">.</span><span class="n">columnDiameter</span> <span class="o">-</span> <span class="n">cond2</span><span class="o">.</span><span class="n">columnDiameter</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span> <span class="o">*</span> <span class="n">cond1</span><span class="o">.</span><span class="n">columnDiameter</span> <span class="ow">and</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">cond1</span><span class="o">.</span><span class="n">columnLength</span> <span class="o">-</span> <span class="n">cond2</span><span class="o">.</span><span class="n">columnLength</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span> <span class="o">*</span> <span class="n">cond1</span><span class="o">.</span><span class="n">columnLength</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
                <span class="c1">#abs(cond1.feedVolume - cond2.feedVolume) &lt; tolerance * cond1.feedVolume):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates if exp2 is close to exp1 with tolerance(default 0.05)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Operator.Cluster_Match_Exp"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Cluster_Match_Exp">[docs]</a>    <span class="k">def</span> <span class="nf">Cluster_Match_Exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exp1</span><span class="p">,</span> <span class="n">exp2</span><span class="p">,</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="n">exp1</span><span class="o">.</span><span class="n">experimentCondition</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">exp2</span><span class="o">.</span><span class="n">experimentCondition</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cond1</span><span class="o">.</span><span class="n">flowRate</span> <span class="o">-</span> <span class="n">cond2</span><span class="o">.</span><span class="n">flowRate</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span> <span class="o">*</span> <span class="n">cond1</span><span class="o">.</span><span class="n">flowRate</span> <span class="ow">and</span>
           <span class="nb">abs</span><span class="p">(</span><span class="n">cond1</span><span class="o">.</span><span class="n">columnDiameter</span> <span class="o">-</span> <span class="n">cond2</span><span class="o">.</span><span class="n">columnDiameter</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span> <span class="o">*</span> <span class="n">cond1</span><span class="o">.</span><span class="n">columnDiameter</span> <span class="ow">and</span>
           <span class="nb">abs</span><span class="p">(</span><span class="n">cond1</span><span class="o">.</span><span class="n">columnLength</span> <span class="o">-</span> <span class="n">cond2</span><span class="o">.</span><span class="n">columnLength</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span> <span class="o">*</span> <span class="n">cond1</span><span class="o">.</span><span class="n">columnLength</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates key for cluster dictionary from component</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Operator.Create_Key"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Create_Key">[docs]</a>    <span class="k">def</span> <span class="nf">Create_Key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">name</span>
        <span class="n">feedConc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">feedConcentration</span><span class="p">)</span>
        <span class="n">colDia</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">columnDiameter</span><span class="p">)</span>
        <span class="n">colLen</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">columnLength</span><span class="p">)</span>
        <span class="n">feedVol</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">feedVolume</span><span class="p">)</span>
        <span class="n">flowRate</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">experimentCondition</span><span class="o">.</span><span class="n">flowRate</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">feedConc</span><span class="p">,</span> <span class="n">colDia</span><span class="p">,</span> <span class="n">colLen</span><span class="p">,</span> <span class="n">feedVol</span><span class="p">,</span> <span class="n">flowRate</span><span class="p">])</span></div>

<div class="viewcode-block" id="Operator.Print_Component_Graph"><a class="viewcode-back" href="../../objects.html#objects.Operator.Operator.Print_Component_Graph">[docs]</a>    <span class="k">def</span> <span class="nf">Print_Component_Graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experimentComponent</span><span class="p">):</span>
        <span class="n">experimentComponent</span><span class="o">.</span><span class="n">concentrationTime</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ChroMo</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Adam Svoboda, Tomas Svoboda.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>